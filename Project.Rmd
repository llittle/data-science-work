---
title: "Project"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
```

First import the first level of the dataset with the correct column names.
```{r Level1, include = FALSE}
string <-"Nss69/Nss69_1.2/Data/R6912L01.TXT"
imported_data_lvl1 <- read_tsv(file = string, col_names = FALSE)


lvl1 <- imported_data_lvl1 %>%
   separate(col = 'X1', into = c('Centre, Round',
                                 'RowID',
                                 'Level',
                                 'Filler',
                                 'Informants relation to head',
                                 'Response Code',
                                 'Survey Code',
                                 'Reason for substitution',
                                 'Sp. Characters for OK stamp',
                                 'Blank',
                                 'SSC',
                                 'NSS',
                                 'NSC',
                                 'MLT'
                                 ),
            sep=c(3,
                  34,
                  36,
                  41,
                  42,
                  43,
                  44,
                  45,
                  47,
                  126,
                  127,
                  130,
                  133,
                  143)) %>%
   separate(col = 'RowID', into = c('FSU Serial number',
                                    'Round',
                                    'Schedule Number',
                                    'Sample',
                                    'Sector',
                                    'State',
                                    'Region',
                                    'District',
                                    'Stratum',
                                    'Sub-Stratum',
                                    'Sub-Round',
                                    'Sub-Sample',
                                    'FOD Sub-Region',
                                    'hg/ sb Number',
                                    'Second Stage Stratum no.',
                                    'Sample household no.'),
            sep = c(5,
                    7,
                    10,
                    11,
                    12,
                    14,
                    15,
                    17,
                    19,
                    21,
                    22,
                    23,
                    27,
                    28,
                    29
                    ),
            remove = FALSE
   )

```
Next import the 'Level 2' of the dataset. The first 34 bytes should match up with 
the level 1 dataset. 
```{r Level2, include = FALSE}
string <-"Nss69/Nss69_1.2/Data/R6912L02.TXT"
imported_data_lvl2 <- read_tsv(file = string, col_names = FALSE)


lvl2 <- imported_data_lvl2 %>%
   separate(col = 'X1', into = c('Centre, Round',
                                 'RowID',
                                 'Level',
                                 'Filler',
                                 'Household size-Male',
                                 'Household size-Female',
                                 'Household size- Total',
                                 'Gender of the head',
                                 'Age of head',
                                 'Highest level of education among male',
                                 'Highest level of education among female',
                                 'Principal industry(NIC-2008)',
                                 'Principal occupation(NCO-2004)',
                                 'Household type',
                                 'Religion' ,
                                 'Social group',
                                 'Land possessed',
                                 'Tenurial status of dwelling',
                                 'Area type where dwelling unit located',
                                 'Maximum distance to the place of work of the earner member',
                                 'Special characters for OK stamp',
                                 'Blank',
                                 'SSC',
                                 'NSS',
                                 'NSC',
                                 'MLT'
                                 ),
            sep = c(3,
                    34,
                    36,
                    41,
                    43,
                    45,
                    47,
                    48,
                    49,
                    51,
                    53,
                    58,
                    61,
                    62,
                    63,
                    64,
                    66,
                    67,
                    68,
                    69,
                    71,
                    126,
                    127,
                    130,
                    133,
                    143)) 
```

Next import the population dataset (from a different source). We hope to align this
with the first two datasets, but need to check how to do that. 
```{r PopData, include = FALSE}
df_3 <- read_csv('A-1_NO_OF_VILLAGES_TOWNS_HOUSEHOLDS_POPULATION_AND_AREA.csv', col_names = TRUE,
         skip = 4)
```
Lets check that the multiplier values are the same for both tabels
```{r Tidying}
check1 <- lvl1 %>%
   count(`MLT`, sort = TRUE)

check2 <- lvl2 %>%
   count(`MLT`, sort = TRUE)

all_equal(check1, check2)
```
Seems ok! 
Lets combine the two levels into one dataframe


```{r Concat, results = 'hide'}

df_joined <- full_join(lvl1, lvl2, by = 'RowID', keep = TRUE)
# df_data <-
#   df_q4 %>%
#   select(
#     date,
#     county,
#     state,
#     fips,
#     cases,
#     deaths,
#     population = `Estimate!!Total`
#   )

```

```{r}
df_joined %>%
   unite(col = 'df_3_Id', c() remove = FALSE,


## Todo
- pivot wider to combine everything
   - make sure thet if the unique column ID matches up, the multiplier also matches up
   - Should we make the mulitplier part of the unique ID as a way of ensuring that this is the case?
- Replace the entries in the columns of interest with the actual words of interest so that our results are easier to interpret
- Find a way to pivot the population dataset into the master dataset

 
 ## Areas to Explore
 
 'results' are 
 - land  Schedule 1.2 item 13 block 3
 - spending spending amount (item 22, block 3)
 
 'indicators' are
 - population density
       - we found a separate dataset for population density of rural vs urban 
      areas for each district
      - The rural vs urban distinction appears on item 5 block 1 of the schedule
      - we will compile those two and assume that the definition of urban and rural
      is close enough
 - income source (item 10, block 3)
 
 - we want to filter to only look at certain population densities to 10k-16k people / km^2